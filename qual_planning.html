
<head>
    <link href="https://fonts.googleapis.com/css?family=Abel" rel="stylesheet">

<style type="text/css">
    .main {
        width: 740px;
        margin: auto;
        background: white;
        padding: 20px;
        font-family: 'Abel', sans-serif;
        font-size: 150%;
        line-height: 200%;
    }
	.style-2 input[type="text"] {
		padding: 10px;
  		border: solid 5px #c9c9c9;
  		transition: border 0.3s;
		width: 520px;
		height: 200px;
		
	}
	.style-2 input[type="text"]:focus,
	.style-2 input[type="text"].focus {
 		 border: solid 5px #969696;
	}
	#three {
		display: flex;
		justify-content: center;
	}
	h2 {
		display: flex;
		justify-content: flex-start;
	}
	input {
    padding: 12px 20px;
    margin: 8px 0;
	vertical-align: text-top;
    color: black;
	font-size: 15px;
	font-family: 'Abel', sans-serif;
	vertical-align: top;
		text-align:top;
	}
  #header {
        font-style: italic;
        font-weight: bold;
        display: flex;
        font-size: 240%;
    }
    p.header1 {
        display: flex;
        justify-content: left;
        size: 40px;
    }    
	textarea#styled {
		width: 620px;
		height: 200px;
		border: 5px solid #cccccc;
		padding: 5px;
		font-family: 'Abel', sans-serif;
		background-image: url(bg.gif);
		background-position: bottom right;
		background-repeat: no-repeat;
		font-size: 25px;
		line-height: 150%;
	}
	p.subm {
        display: flex;
		justify-content: center;
    }
</style>
<script>
	
         //////////////////////////////////////////////
        //               Logging User Data           //
        //////////////////////////////////////////////

        var chap;
        var seq;
        var vert;
        var origin;
        var username;
        var userid;
        var myId;
        var course;


        function get_data() {
          username = analytics._user._getTraits().username;
          userid = analytics.user()._getId();
          var url = window.location.href;
          var split = url.split("/");
          chap = split[6];
          seq = split[7];
          var block = $('#sequence-list .nav-item.active').data('id');
          vert = block.split("@").pop();
          course = split[4].split(":")[1];
          origin = chap+"/"+seq+"/"+vert;
          console.log("user: " + userid);
          console.log("course: " + course);
          console.log("origin: " + origin);
          console.log("week: " + chap);
          $('#dx-username').text(username);
        }
          
          get_data();


        //////////////////////////////////////////////
        //////////////////////////////////////////////


</script>

<script>


// ***************************************************************
                    // ACTIVITY DATA KEYS

                    // TIME: datas.time
                    // Videos: datas.watched
                    // Quiz: datas.uniqueSubmits
// ***************************************************************  



        //////////////////////////////////////////////
        //          Logging User Video Activity       //
        //////////////////////////////////////////////
var datas = {};
//Holds a reference to the YouTube player
var ik_player;

//this function is called by the API
window.onload = function onYouTubeIframeAPIReady() {
  //creates the player object
  var playerId = $('iframe').attr('id');
  ik_player = new YT.Player(playerId);
       
  console.log('Video API is loaded');
       
  //subscribe to events
  ik_player.addEventListener("onStateChange", "onYouTubePlayerStateChange");
}
var k = [];
function onYouTubePlayerStateChange(event) {
  var d = new Date();
  var n = d.getTime();
  k.push(n/1000);

  
function diff(ary) {
    var newA = [];
    for (var i = 1; i < ary.length; i++)  newA.push(ary[i] - ary[i - 1])
    return newA;
};


//console.log(diff(k));
var diffy = diff(k);
var ar =[];
for (var i = 0; i < diffy.length; i++) {
    if(i % 2 === 0) { 
        ar.push(diffy[i]);
    }
  //console.log(ar);
  var sum = ar.reduce(add, 0);

function add(a, b) {
    return a + b;
}
var playerId = $('iframe').attr('id');
datas.vidID = playerId;
datas.vidDuration = sum;
if (sum > 30) {
  datas.watched = 1;
} else {
  datas.watched = 0
};
console.log(datas);
}
;
  
}
 
         //////////////////////////////////////////////
         ////////////////////////////////////////////// 


         //////////////////////////////////////////////
        //          Logging User Quiz Activity       //
        //////////////////////////////////////////////
var datas = {};
var subs = [];
var uniqueSubs =[];

setTimeout(function(){
  for (i=0; i<100; i++) {
    document.getElementsByClassName("submit btn-brand")[i].addEventListener("click", myFunction);
  }
}, 3000);

  
function myFunction() {
  subs.push(this.parentNode.parentNode.parentNode.parentNode.id);
  console.log(subs);
  datas.submits = subs;
  $.each(subs, function(i, el){
    if($.inArray(el, uniqueSubs) === -1) uniqueSubs.push(el);
});
  console.log(uniqueSubs.length);
  datas.uniqueSubmits = uniqueSubs.length;
  console.log(datas);
};




// window.onbeforeunload = function() {
//  sendData();
// };


         //////////////////////////////////////////////
         //////////////////////////////////////////////


         //////////////////////////////////////////////
        //          Logging User Time Spent        //
        //////////////////////////////////////////////

          var time,timeSite;
          setTimeout(function(){
           time=new Date();
          }, 1000);


          window.onbeforeunload=function(){
           timeSite=new Date()-time;
           var datas = {};
           datas.time = timeSite;
           console.log(timeSite);
           return datas;
          }


         //////////////////////////////////////////////
         //////////////////////////////////////////////



</script>

<body>

<p id="header">WHAT DRIVES YOU?</p>
	<p class="header1">Please share what's motivating you to be a part of this course community.</p>

  <form id="usrform" onsubmit="submitting();">
  <div id="three">
           <textarea form="usrform" name="styled-textarea" id="styled" onfocus="this.value=''; setbg('#e5fff3');" onblur="setbg('white')">Enter your story here...</textarea>
        </div>
	</form>
 <p class="subm"> <input type="image" alt="Submit" src="http://www.wis.ewi.tudelft.nl/fileadmin/wis/homepages/davis/images/button.png"> </p>


<script>


         //////////////////////////////////////////////
        //          Logging Qual Planning            //
        //////////////////////////////////////////////


            function submitting() {
              var textArea = $( "textarea" ).text();
              console.log(textArea);
            };

         //////////////////////////////////////////////
         //////////////////////////////////////////////

</script>



</body>
