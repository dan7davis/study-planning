<head>
    <link href="https://fonts.googleapis.com/css?family=Abel" rel="stylesheet">
    <script src="/static/mapped.js"></script>

<style type="text/css">

  #videobar {
     margin: 20px;
     width: 200px;
       height: 100px;
  }

  #questionbar {
      margin: 20px;
      width: 200px;
      height: 100px;
  }

  #timebar {
      margin: 20px;
      width: 200px;
      height: 100px;
  }

  #videotex {
     margin: 20px;
     width: 200px;
       height: 50px;
       font-size: 140%;
  }

  #questiontex {
      margin: 20px;
      width: 200px;
      height: 50px;
      font-size: 140%;
  }

  #timetex {
      margin: 20px;
      width: 200px;
      height: 50px;
      font-size: 140%;
  }
  #three {
    display: flex;
    justify-content: space-around;
  }

  #header {
        font-style: italic;
        font-family: 'Abel';
        font-weight: bold;
        display: flex;
        font-size: 240%;
    }
.emerald-flat-button-small {
  position: relative !important;
  display: block !important;
  vertical-align: top !important;
  width: 15% !important;
  clear: both;
  height: 30px !important;
  opacity: 1 !important;
  font-family: 'Abel', sans-serif !important;
  padding: 0 !important;
  font-size: 15px !important;
  color: white !important;
  text-shadow: 0 1px 2px rgba(0, 0, 0, 0.25) !important;
  background: #2ecc71 !important;
  border: 0 !important;
  border-bottom: 2px solid #28be68 !important;
  cursor: pointer !important;
  -webkit-box-shadow: inset 0 -2px #28be68 !important;
  box-shadow: inset 0 -2px #28be68 !important;
  transition: all 0.3s ease 0s !important;
}
.emerald-flat-button-small:hover {
  opacity: 0.75 !important;
}
.emerald-flat-button-small:active {
  top: 1px !important;
  outline: none !important;
  -webkit-box-shadow: none !important;
  box-shadow: none !important;
}
#replace {
  display: none;

}
#startPlan {
  display: block;
}

</style>
<script src="/static/pbref.js"></script>

<script>
  
         //////////////////////////////////////////////
        //               Logging User Data           //
        //////////////////////////////////////////////

        var chap;
        var seq;
        var vert;
        var origin;
        var username;
        var userid;
        var myId;
        var course;
        var time;
        var datas = {};



        function get_data() {
          username = analytics._user._getTraits().username;
          var url = window.location.href;
          var split = url.split("/");
          chap = split[6];
          datas.week = chap;
          seq = split[7];
          var block = $('#sequence-list .nav-item.active').data('id');
          vert = block.split("@").pop();
          course = split[4].split(":")[1];
          origin = chap+"/"+seq+"/"+vert;
          userid = analytics.user()._getId();
          datas.id = userid;
          datas.course = course;
          datas.time = new Date();
          datas.index = datas.id + "_" + datas.time.getTime();
          datas.vert = vert;
          console.log("user: " + userid);
          console.log("course: " + course);
          console.log("origin: " + origin);
          console.log("week: " + chap);
          $('#dx-username').text(username);
        }
          
          

          //////////////////////////////////////////////
// Retrieve Current Weeks Vid and Quiz Info //
//////////////////////////////////////////////

  for (i=0; i < mapped.length; i++) {
  if (mapped[i][0] !== chap) {
    var corrVid = mapped[i][1];
    var corrQuiz = mapped[i][2];
  } else {
    var corrVid = "";
    var corrQuiz = "";
    console.log("Data not found!");
  };
};

//////////////////////////////////////////////


        //////////////////////////////////////////////
        //////////////////////////////////////////////
  
</script>
</head>
<div id="startPlan">
    <script>


// ***************************************************************
                    // ACTIVITY DATA KEYS

                    // TIME: datas.time
                    // Videos: datas.watched
                    // Quiz: datas.uniqueSubmits
// ***************************************************************  



        //////////////////////////////////////////////
        //          Logging User Video Activity       //
        //////////////////////////////////////////////
//Holds a reference to the YouTube player
var ik_player;

//this function is called by the API
window.onload = function onYouTubeIframeAPIReady() {
    get_data();
  //creates the player object
  var playerId = $('iframe').attr('id');
  ik_player = new YT.Player(playerId);
  console.log('Video API is loaded');
       
  //subscribe to events
  ik_player.addEventListener("onStateChange", "onYouTubePlayerStateChange");
}
var k = [];
function onYouTubePlayerStateChange(event) {
  var d = new Date();
  var n = d.getTime();
  k.push(n/1000);

  
function diff(ary) {
    var newA = [];
    for (var i = 1; i < ary.length; i++)  newA.push(ary[i] - ary[i - 1])
    return newA;
};


//console.log(diff(k));
var diffy = diff(k);
var ar =[];
for (var i = 0; i < diffy.length; i++) {
    if(i % 2 === 0) { 
        ar.push(diffy[i]);
    }
  //console.log(ar);
  var sum = ar.reduce(add, 0);

function add(a, b) {
    return a + b;
}
var playerId = $('iframe').attr('id');
datas.vidID = playerId;
datas.vidDuration = sum;
if (sum > 30) {
  datas.watched = 1;
} else {
  datas.watched = 0
};
datas.time = new Date();
datas.index = datas.id + "_" + datas.time.getTime();
console.log(datas);
}
;
  
}
 
         //////////////////////////////////////////////
         ////////////////////////////////////////////// 


         //////////////////////////////////////////////
        //          Logging User Quiz Activity       //
        //////////////////////////////////////////////
var subs = [];
var uniqueSubs =[];

setTimeout(function(){
  for (i=0; i<100; i++) {
    document.getElementsByClassName("submit btn-brand")[i].addEventListener("click", myFunction);
  }
}, 3000);

  
function myFunction() {
  subs.push(this.parentNode.parentNode.parentNode.parentNode.id);
  console.log(subs);
  datas.submits = subs;
  $.each(subs, function(i, el){
    if($.inArray(el, uniqueSubs) === -1) uniqueSubs.push(el);
});
  console.log(uniqueSubs.length);
  datas.uniqueSubmits = uniqueSubs.length;
  datas.time = new Date();
  datas.index = datas.id + "_" + datas.time.getTime();
  console.log(datas);
};




// window.onbeforeunload = function() {
//  sendData();
// };


         //////////////////////////////////////////////
         //////////////////////////////////////////////


         //////////////////////////////////////////////
        //          Logging User Time Spent        //
        //////////////////////////////////////////////
          

          var startTime,timeSite;
          setTimeout(function(){
           startTime=new Date();
          }, 1000);


          window.onbeforeunload=function(){
           timeSite=new Date()-startTime;
           datas.timeSite = timeSite;
           console.log(timeSite);
           datas.time = new Date();
           datas.index = datas.id + "_" + datas.time.getTime();
           console.log(datas);
           alert("Send datas to server!");
           return datas;
          }

         //////////////////////////////////////////////
         //////////////////////////////////////////////


</script>

<body>
<p id="header">Progress towards your goals this week:</p>
  <div id="three">
    <div id="videobar"></div>
    <div id="questionbar"></div>
    <div id="timebar"></div>
  </div>

</body>



<script type="text/javascript">
  
// progressbar.js@1.0.0 version is used
// Docs: http://progressbarjs.readthedocs.org/en/1.0.0/

var vidActual = 26;
var vidIntended = 34;
var vidScaled = vidActual/vidIntended;

var questionActual = 12;
var questionIntended = 17;
var questionScaled = questionActual/questionIntended;


var timeActual = 2;
var timeIntended = 5;
var timeScaled = timeActual/timeIntended;


///////////////////////////////////////////////////////////
//            Video Viz                                   //
///////////////////////////////////////////////////////////

var bar = new ProgressBar.SemiCircle(videobar, {
  strokeWidth: 8,
  color: '#FFEA82',
  trailColor: '#eee',
  trailWidth: 8,
  easing: 'easeInOut',
  duration: 1400,
  svgStyle: null,
  text: {
    value: '1',
    alignToBottom: false
  },
  from: {color: '#ffb366'},
  to: {color: '#00e600'},
  // Set default step function for all animate calls
  step: (state, bar) => {
    bar.path.setAttribute('stroke', state.color);
    var value = Math.round(bar.value() * vidIntended);
    if (value === 0) {
      bar.setText('');
    } else {
      bar.setText(value);
    }

    bar.text.style.color = state.color;
  }
});
bar.text.style.fontFamily = '"Abel", Helvetica, sans-serif';
bar.text.style.fontSize = '2rem';

bar.animate(vidScaled);  // Number from 0.0 to 1.0

///////////////////////////////////////////////////////////
//            Question Viz           //
///////////////////////////////////////////////////////////

var bar2 = new ProgressBar.SemiCircle(questionbar, {
  strokeWidth: 8,
  color: '#FFEA82',
  trailColor: '#eee',
  trailWidth: 8,
  easing: 'easeInOut',
  duration: 1400,
  svgStyle: null,
  text: {
    value: '1',
    alignToBottom: false
  },
  from: {color: '#ffb366'},
  to: {color: '#00e600'},
  // Set default step function for all animate calls
  step: (state, bar2) => {
    bar2.path.setAttribute('stroke', state.color);
    var value = Math.round(bar2.value() * questionIntended);
    if (value === 0) {
      bar2.setText('');
    } else {
      bar2.setText(value);
    }

    bar2.text.style.color = state.color;
  }
});
bar2.text.style.fontFamily = '"Abel", Helvetica, sans-serif';
bar2.text.style.fontSize = '2rem';

bar2.animate(questionScaled);  // Number from 0.0 to 1.0


///////////////////////////////////////////////////////////
//            Time Viz             //
///////////////////////////////////////////////////////////

var bar3 = new ProgressBar.SemiCircle(timebar, {
  strokeWidth: 8,
  color: '#FFEA82',
  trailColor: '#eee',
  trailWidth: 8,
  easing: 'easeInOut',
  duration: 1400,
  svgStyle: null,
  text: {
    value: '1',
    alignToBottom: false
  },
  from: {color: '#ffb366'},
  to: {color: '#00e600'},
  // Set default step function for all animate calls
  step: (state, bar3) => {
    bar3.path.setAttribute('stroke', state.color);
    var value = Math.round(bar3.value() * timeIntended);
    if (value === 0) {
      bar3.setText('');
    } else {
      bar3.setText(value);
    }

    bar3.text.style.color = state.color;
  }
});
bar3.text.style.fontFamily = '"Abel", Helvetica, sans-serif';
bar3.text.style.fontSize = '2rem';

bar3.animate(timeScaled);  // Number from 0.0 to 1.0



</script>

<body>

<div id="three">
    <div id="videotex">You planed for: <span id="vidIntended"></span></div>
    <div id="questiontex">You planed for: <span id="questionIntended"></span></div>
    <div id="timetex">You planed for: <span id="timeIntended"></span></div>
  </div>

<script>


function textgen() {
      document.getElementById("vidIntended").innerHTML=vidIntended;
      document.getElementById("questionIntended").innerHTML=questionIntended;
      document.getElementById("timeIntended").innerHTML=timeIntended;
  };
 
 
 textgen();


</script>

<p><input type="submit" onclick="reveal();edited();" value="Edit Goals" class="emerald-flat-button-small"></p>

</body>
</div>
<!-- ################################################################## -->
<div id="replace">

<style>

  .main {
        width: 740px;
        margin: auto;
        background: white;
        padding: 20px;
        font-family: 'Abel', sans-serif !important;
        font-size: 150%;
        line-height: 200%;
    }
  #three {
    display: flex;
    justify-content: space-around;
    font-family: 'Abel', sans-serif !important;
  }
    p.vid {
      display: block;
      width: 200px;
      font-family: 'Abel', sans-serif !important;
      text-align: center;
      margin: 20px;
    }
    p.quiz {
      display: block;
      width: 200px;
      text-align: center;
      font-family: 'Abel', sans-serif !important;
      margin: 20px;
    }
    p.time {
      display: block;
      font-family: 'Abel', sans-serif !important;
      width: 200px;
      text-align: center;
      margin: 20px;
    }
    p.subm {
        display: flex;
    justify-content: center;
    }
    input.txtenter{
        padding:5px;
        font-family: 'Abel', sans-serif !important;
        font-size: 100%;
        line-height: 100%;
        text-align: center;   
        padding: 0px;
        border: none;
        border-bottom: solid 3px #c9c9c9;
    }
 .emerald-flat-button {
  position: relative !important;
  display: block !important;
  vertical-align: top !important;
  width: 30% !important;
  margin: auto;
  height: 60px !important;
  clear: both !important;
  opacity: 1 !important;
  font-family: 'Abel', sans-serif !important;
  padding: 0 !important;
  font-size: 25px !important;
  color: white !important;
  text-align: center !important;
  text-shadow: 0 1px 2px rgba(0, 0, 0, 0.25) !important;
  background: #2ecc71 !important;
  border: 0 !important;
  border-bottom: 2px solid #28be68 !important;
  cursor: pointer !important;
  -webkit-box-shadow: inset 0 -2px #28be68 !important;
  box-shadow: inset 0 -2px #28be68 !important;
  transition: all 0.3s ease 0s !important;
}
.emerald-flat-button:hover {
  opacity: 0.75 !important;
}
.emerald-flat-button:active {
  top: 1px !important;
  outline: none !important;
  -webkit-box-shadow: none !important;
  box-shadow: none !important;
}
  #header {
        font-style: italic;
        font-family: 'Abel';
        font-weight: bold;
        display: flex;
        font-size: 240%;
        margin-bottom: 0;
    }
</style>  


<script>
       //////////////////////////////////////////////
        //          Logging Qual Planning            //
        //////////////////////////////////////////////
            var quantGoals = [];

            var subby = $("form").submit(function(e){
              e.preventDefault();
              quantGoals[0] = Number($( "#vids").val());
              quantGoals[1] = Number($( "#quizs").val());
              quantGoals[2] = Number($( "#times").val());   
              datas.quantGoals = quantGoals;
              alert("Great! Stick to your goals and you'll succeed!"); 
              console.log(datas);
              e.preventDefault();          
            });




         //////////////////////////////////////////////
         //////////////////////////////////////////////


</script>

</head>
<body>
<main class="main">  
  <p id="header">THIS WEEK...</p>



<form id="qtPlan" onsubmit="return false">
  <div id="three">
  <p class="vid">I plan to <i>watch</i>...<br>
  <br>
  <input class="txtenter" id= "vids" type="text" name="pin" maxlength="4" size="2" input style="font-size:120%"> / <span id="vidzn"></span> <br>
  <br> 
  Lecture Videos. </p>

  <p class="quiz">I plan to <i>answer</i>...<br>
  <br>
  <input class="txtenter" id= "quizs" type="text" name="pin" maxlength="4" size="2" input style="font-size:120%"> / <span id="quizdzn"></span> <br>
  <br> 
  Quiz Questions. </p>

  <p class="time">I plan to <i>devote</i>...<br>
  <br>
  <input class="txtenter" id= "times" type="text" name="pin" maxlength="4" size="2" input style="font-size:120%"> / 4 <br>
  <br> 
  hours to the course. </p>

  </div>


 <input type="submit" onclick="subby" value="Submit" class="emerald-flat-button"> 
 <br>
 <p id="buts">
 <input type="submit" onclick="reveal()" value="View Progress" class="emerald-flat-button-small"> 
</p>
</form>

</main>
</body>

<script>

          // Populate Dzn Fields

          function populate() {
            document.getElementById("vidzn").innerHTML=corrVid;
            document.getElementById("quizdzn").innerHTML=corrQuiz;
          };

          populate();

</script>



</div>



<script>
  

  get_data();


  function edited() {
  datas.edited = 1;
  datas.time = new Date();
  datas.index = datas.id + "_" + datas.time.getTime();
};

  function reveal() {
      $("#replace").toggle();
      $("#startPlan").toggle();
  };

  $(".sequence-nav").unbind('click').click(function () {
    alert("Send datas to server!");
    datas = {};
    get_data();
  })
s

</script>

